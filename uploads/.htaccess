# ==============================================================
# Uploads Directory - Security Configuration
# ==============================================================

# Disable PHP execution in uploads directory
# This prevents uploaded PHP files from being executed

# Method 1: Disable PHP engine
<IfModule mod_php.c>
    php_flag engine off
</IfModule>

<IfModule mod_php7.c>
    php_flag engine off
</IfModule>

<IfModule mod_php8.c>
    php_flag engine off
</IfModule>

# Method 2: Force download for all files that could be dangerous
<FilesMatch "\.(?:php[0-9]?|phtml|phar|phps)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Method 3: Remove handlers for PHP files
<IfModule mod_mime.c>
    RemoveHandler .php .phtml .php3 .php4 .php5 .php7 .php8 .phar .phps
    RemoveType .php .phtml .php3 .php4 .php5 .php7 .php8 .phar .phps
</IfModule>

# Force download for any script-like files
<FilesMatch "\.(php|phtml|php3|php4|php5|php7|php8|phar|phps|pl|py|jsp|asp|aspx|cgi|sh|bash)$">
    ForceType application/octet-stream
    Header set Content-Disposition attachment
</FilesMatch>

# Block access to hidden files
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Only allow specific image types
<FilesMatch "\.(?:jpe?g|png|gif|webp|svg|ico)$">
    Order allow,deny
    Allow from all
</FilesMatch>

# Prevent directory listing
Options -Indexes

# Disable script execution via other methods
Options -ExecCGI
AddHandler cgi-script .php .phtml .php3 .php4 .php5 .php7 .php8 .pl .py .jsp .asp .aspx .cgi .sh

# Set proper MIME types for images
<IfModule mod_mime.c>
    AddType image/jpeg .jpg .jpeg
    AddType image/png .png
    AddType image/gif .gif
    AddType image/webp .webp
    AddType image/svg+xml .svg
</IfModule>

# Cache images
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
</IfModule>
